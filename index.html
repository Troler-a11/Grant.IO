<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TRUST_NODE | Escrow System</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>
<body>

    <div class="menu-icon" onclick="toggleMenu()">‚ò∞</div>

    <div class="sidebar" id="sidebar">
        <div id="g_id_onload" data-client_id="–í–°–¢–ê–í_GOOGLE_ID" data-callback="onSignIn"></div>
        <div class="g_id_signin" data-type="standard"></div>
        <div id="user-info" style="display:none; margin-top:20px;">
            <p>ID: <span id="my-id">...</span></p>
            <p>Email: <span id="my-email">...</span></p>
            <a href="https://t.me/pingvin4ikpororo" target="_blank" class="menu-link">‚úàÔ∏è –ü—ñ–¥—Ç—Ä–∏–º–∫–∞</a>
        </div>
        <div id="admin-panel" style="display:none; border-top:1px solid gold; margin-top:20px;">
            <h4 style="color:gold">ADMIN LOGS</h4>
            <div id="admin-messages"></div>
        </div>
    </div>

    <div class="hero">
        <div id="start-screen">
            <h1 class="logo">TRUST_NODE</h1>
            <div class="stats"><b>10,000+</b> —É–≥–æ–¥ | <b>4.9/5</b> —Ä–µ–π—Ç–∏–Ω–≥</div>
            <button class="btn-main" id="start-btn" onclick="showConnect()" disabled>–í–ò–ö–û–ù–ê–¢–ò –£–ì–û–î–£</button>
            <p id="login-warn">–ê–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å —á–µ—Ä–µ–∑ Google –¥–ª—è –ø–æ—á–∞—Ç–∫—É</p>
        </div>

        <div class="glass" id="step-connect" style="display:none">
            <h3>–°—Ç–≤–æ—Ä–µ–Ω–Ω—è –º–æ—Å—Ç—É</h3>
            <input type="text" id="target-id" placeholder="–í–≤–µ–¥—ñ—Ç—å ID –ü–æ–∫—É–ø—Ü—è">
            <input type="number" id="deal-price" placeholder="–°—É–º–∞ —É–≥–æ–¥–∏ (‚Ç¥)">
            <button class="btn-main" onclick="createDeal()">–°–¢–í–û–†–ò–¢–ò –£–ì–û–î–£</button>
        </div>

        <div class="glass" id="step-confirm" style="display:none">
            <h3>–ó–∞–ø–∏—Ç –Ω–∞ —É–≥–æ–¥—É!</h3>
            <p id="confirm-text"></p>
            <button class="btn-main" onclick="approveDeal(true)">–¢–ê–ö, –¶–ï –Ø</button>
            <button class="btn-main" style="background:#ff4444; margin-top:10px;" onclick="approveDeal(false)">–í–Ü–î–ú–û–í–ò–¢–ò–°–Ø</button>
        </div>

        <div class="glass" id="step-pay" style="display:none">
            <h2 id="pay-title">–î–æ —Å–ø–ª–∞—Ç–∏: 0 ‚Ç¥</h2>
            <div id="payment-status" class="status-box">–û—á—ñ–∫—É–≤–∞–Ω–Ω—è –ø–µ—Ä—à–æ–≥–æ –≤–Ω–µ—Å–∫—É...</div>
            <input type="text" placeholder="–ö–∞—Ä—Ç–∞ **** **** **** ****">
            <button class="btn-main" onclick="checkMonoBalance()">–ü–ï–†–ï–í–Ü–†–ò–¢–ò –û–ü–õ–ê–¢–£</button>
        </div>

        <div class="glass" id="step-finish" style="display:none">
            <h3 id="finish-msg">–ì—Ä–æ—à—ñ –≤ –ì–∞—Ä–∞–Ω—Ç–∞!</h3>
            <div id="buyer-confirm-area" style="display:none">
                <p>–û—Ç—Ä–∏–º–∞–ª–∏ —Ç–æ–≤–∞—Ä? –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –∫–Ω–æ–ø–∫—É –Ω–∏–∂—á–µ:</p>
                <button class="btn-main" onclick="closeDeal()">–ü–Ü–î–¢–í–ï–†–î–ò–¢–ò –û–¢–†–ò–ú–ê–ù–ù–Ø</button>
            </div>
        </div>
    </div>

    <script src="config.js"></script>
    <script>
        <!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TRUST_NODE | Professional Escrow</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>
<body>

    <div class="menu-icon" onclick="toggleMenu()">‚ò∞</div>

    <div class="sidebar" id="sidebar">
        <div id="g_id_onload" 
             data-client_id="–í–°–¢–ê–í_–°–í–Ü–ô_ID_–¢–£–¢.apps.googleusercontent.com" 
             data-callback="onSignIn">
        </div>
        <div class="g_id_signin" data-type="standard"></div>
        
        <div id="user-info" style="display:none; margin-top:30px;">
            <p style="color:var(--main)">Verified ‚úÖ</p>
            <p>ID: <span id="my-id">...</span></p>
            <a href="https://t.me/pingvin4ikpororo" target="_blank" class="menu-link">‚úàÔ∏è Support @pingvin4ikpororo</a>
        </div>

        <div id="admin-panel" style="display:none; border-top:1px solid gold; margin-top:20px; padding-top:10px;">
            <h4 style="color:gold">ADMIN CENTER</h4>
            <div id="admin-logs" style="font-size: 11px;"></div>
        </div>
    </div>

    <div class="hero">
        <div id="screen-main">
            <h1 class="logo">TRUST_NODE</h1>
            <div class="stats-grid">
                <div class="stat-item"><h2>10k+</h2><p>–£–≥–æ–¥</p></div>
                <div class="stat-item"><h2>4.9</h2><p>–†–µ–π—Ç–∏–Ω–≥</p></div>
            </div>
            <button class="btn-main" id="start-btn" onclick="showStep('connect')" disabled>–í–ò–ö–û–ù–ê–¢–ò –£–ì–û–î–£</button>
            <p id="login-warn" style="font-size:12px; color:#555; margin-top:10px;">–ê–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å —á–µ—Ä–µ–∑ Google</p>
        </div>

        <div class="glass" id="screen-connect" style="display:none">
            <h3>–°—Ç–≤–æ—Ä–µ–Ω–Ω—è —É–≥–æ–¥–∏</h3>
            <input type="text" id="target-buyer" placeholder="ID –ü–æ–∫—É–ø—Ü—è (–Ω–∞–ø—Ä. TN-123)">
            <input type="number" id="deal-amount" placeholder="–°—É–º–∞ (‚Ç¥)">
            <button class="btn-main" onclick="initBridge()">–°–¢–í–û–†–ò–¢–ò –ú–Ü–°–¢</button>
        </div>

        <div class="glass" id="screen-confirm" style="display:none">
            <h3 id="confirm-msg">–ó–∞–ø–∏—Ç –Ω–∞ –ø–æ–∫—É–ø–∫—É</h3>
            <button class="btn-main" onclick="handleBridge(true)">–¢–ê–ö, –ö–£–ü–£–Æ</button>
            <button class="btn-main" style="background:#333; margin-top:10px;" onclick="handleBridge(false)">–í–Ü–î–ú–û–í–ê</button>
        </div>

        <div class="glass" id="screen-pay" style="display:none">
            <h2 id="display-price">0.00 ‚Ç¥</h2>
            <div id="pay-status" class="status-box">–û—á—ñ–∫—É–≤–∞–Ω–Ω—è –æ–ø–ª–∞—Ç–∏...</div>
            <input type="text" placeholder="–ö–∞—Ä—Ç–∞ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó">
            <button class="btn-main" onclick="syncMono()">–ü–ï–†–ï–í–Ü–†–ò–¢–ò –ë–ê–õ–ê–ù–°</button>
        </div>

        <div class="glass" id="screen-finish" style="display:none">
            <h3 style="color:var(--main)">–ì–†–û–®–Ü –ó–ê–ú–û–†–û–ñ–ï–ù–û üõ°Ô∏è</h3>
            <p id="finish-instruction" style="font-size:14px;"></p>
            <div id="buyer-confirm" style="display:none">
                <button class="btn-main" onclick="completeDeal()">–ü–Ü–î–¢–í–ï–†–î–ò–¢–ò –û–¢–†–ò–ú–ê–ù–ù–Ø</button>
            </div>
        </div>
    </div>

    <div id="reviews-block" style="padding: 50px 20px;">
        <h3>–í—ñ–¥–≥—É–∫–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ (314)</h3>
        <div id="rev-list"></div>
    </div>

    <script src="config.js"></script>
    <script>
        let currentDealId = null;

        function toggleMenu() { document.getElementById('sidebar').classList.toggle('active'); }

        function onSignIn(resp) {
            const payload = JSON.parse(atob(resp.credential.split('.')[1]));
            user.email = payload.email;
            document.getElementById('user-info').style.display = 'block';
            document.getElementById('login-warn').style.display = 'none';
            document.getElementById('start-btn').disabled = false;
            document.getElementById('my-id').innerText = user.id;
            if(user.email === CONFIG.adminEmail) document.getElementById('admin-panel').style.display = 'block';
            listenForDeals();
        }

        function showStep(step) {
            document.querySelectorAll('.glass, #screen-main').forEach(el => el.style.display = 'none');
            document.getElementById('screen-' + step).style.display = 'block';
        }

        // –õ–æ–≥—ñ–∫–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –º–æ—Å—Ç—É
        async function initBridge() {
            const buyer = document.getElementById('target-buyer').value;
            const price = parseFloat(document.getElementById('deal-amount').value);
            if(!buyer || !price) return alert("–ó–∞–ø–æ–≤–Ω—ñ—Ç—å –¥–∞–Ω—ñ!");
            
            currentDealId = user.id + "_" + buyer;
            await db.collection("deals").doc(currentDealId).set({
                seller: user.id,
                buyer: buyer,
                amount: price,
                paid: 0,
                status: "waiting",
                timestamp: Date.now()
            });
            alert("–ó–∞–ø–∏—Ç –Ω–∞–¥—ñ—Å–ª–∞–Ω–æ –ø–æ–∫—É–ø—Ü—é. –û—á—ñ–∫—É–π—Ç–µ.");
        }

        // –°–ª—É—Ö–∞—á –¥–ª—è –ø–æ–∫—É–ø—Ü—è
        function listenForDeals() {
            db.collection("deals").where("buyer", "==", user.id).onSnapshot(snap => {
                snap.docChanges().forEach(change => {
                    const data = change.doc.data();
                    currentDealId = change.doc.id;
                    if(data.status === "waiting") {
                        document.getElementById('confirm-msg').innerText = `–í–∏ –∫—É–ø—É—î—Ç–µ —É ${data.seller} –∑–∞ ${data.amount} ‚Ç¥?`;
                        showStep('confirm');
                    }
                    updateUI(data);
                });
            });
        }

        async function handleBridge(agree) {
            if(agree) {
                await db.collection("deals").doc(currentDealId).update({ status: "active" });
                showStep('pay');
            } else {
                await db.collection("deals").doc(currentDealId).delete();
                location.reload();
            }
        }

        // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ Monobank
        async function syncMono() {
            const doc = await db.collection("deals").doc(currentDealId).get();
            const deal = doc.data();
            
            document.getElementById('pay-status').innerText = "–°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è –∑ –±–∞–Ω–∫–æ–º...";
            
            const res = await fetch(`https://api.monobank.ua/personal/statement/0/${Math.floor(Date.now()/1000)-600}`, {
                headers: {'X-Token': CONFIG.monoToken}
            });
            const data = await res.json();
            
            // –†–∞—Ö—É—î–º–æ —Å—É–º—É –≤—Å—ñ—Ö –ø—ñ–¥—Ö–æ–¥—è—â–∏—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π
            let totalPaid = data
                .filter(t => t.amount > 0)
                .reduce((s, t) => s + (t.amount / 100), 0);

            const need = deal.amount - totalPaid;

            if(need <= 0) {
                await db.collection("deals").doc(currentDealId).update({ status: "paid", paid: totalPaid });
            } else {
                document.getElementById('pay-status').innerText = `–û—Ç—Ä–∏–º–∞–Ω–æ ${totalPaid} ‚Ç¥. –î–æ —Å–ø–ª–∞—Ç–∏ —â–µ ${need.toFixed(2)} ‚Ç¥`;
            }
        }

        function updateUI(data) {
            if(data.status === "paid") {
                showStep('finish');
                if(user.id === data.seller) {
                    document.getElementById('finish-instruction').innerText = "–ì—Ä–æ—à—ñ –≤ –ì–∞—Ä–∞–Ω—Ç–∞. –ü–µ—Ä–µ–¥–∞–π—Ç–µ –¥–∞–Ω—ñ –ø–æ–∫—É–ø—Ü—é.";
                } else {
                    document.getElementById('finish-instruction').innerText = "–û–ø–ª–∞—Ç–∞ —É—Å–ø—ñ—à–Ω–∞. –û—á—ñ–∫—É–π—Ç–µ –¥–∞–Ω—ñ –≤—ñ–¥ –ø—Ä–æ–¥–∞–≤—Ü—è.";
                    document.getElementById('buyer-confirm').style.display = 'block';
                }
                if(user.email === CONFIG.adminEmail) showAdminInfo(data);
            }
        }

        function showAdminInfo(data) {
            const profit = data.amount * CONFIG.fee;
            document.getElementById('admin-logs').innerHTML = `
                <div style="background:#1a1a1a; padding:5px; margin-bottom:5px;">
                    –£–≥–æ–¥–∞: ${data.amount} ‚Ç¥<br>
                    –¢–≤—ñ–π –ø—Ä–æ—Ñ—ñ—Ç: ${profit.toFixed(2)} ‚Ç¥<br>
                    –í–∏–ø–ª–∞—Ç–∞ –ø—Ä–æ–¥–∞–≤—Ü—é: ${(data.amount - profit).toFixed(2)} ‚Ç¥
                </div>`;
        }

        // –í—ñ–¥–≥—É–∫–∏ (–∑–∞–≥–ª—É—à–∫–∞)
        const revs = ["–ö—Ä—É—Ç–∏–π —Å–µ—Ä–≤—ñ—Å!", "–í—Å–µ —à–≤–∏–¥–∫–æ", "–ì–∞—Ä–∞–Ω—Ç —Å—É–ø–µ—Ä", "–†–µ–∫–æ–º–µ–Ω–¥—É—é"];
        document.getElementById('rev-list').innerHTML = revs.map(r => `<div class="review-card"><b>User_${Math.floor(Math.random()*100)}</b>: ${r}</div>`).join('');
    </script>
</body>
</html>
    </script>
</body>
</html>
 
 
