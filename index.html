<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TRUST_NODE | Professional Escrow</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <style>
        :root { --main: #00f2ff; --bg: #0a0b10; }
        body { background: var(--bg); color: white; font-family: 'Segoe UI', sans-serif; margin: 0; overflow-x: hidden; }
        
        /* –ü—Ä–æ—Ñ—ñ–ª—å (–ö—Ä—É–≥–ª–∞ –∫–Ω–æ–ø–∫–∞ –∑ —Ñ–æ—Ç–æ) */
        .profile-trigger { position: fixed; top: 20px; left: 20px; width: 45px; height: 45px; border-radius: 50%; border: 2px solid var(--main); cursor: pointer; z-index: 1000; overflow: hidden; background: #222; }
        .profile-trigger img { width: 100%; height: 100%; object-fit: cover; }
        
        .profile-card { display: none; position: fixed; top: 75px; left: 20px; background: #111; border: 1px solid var(--main); padding: 20px; border-radius: 15px; z-index: 1001; width: 260px; box-shadow: 0 10px 40px rgba(0,0,0,0.8); }
        
        /* –ú–µ–Ω—é (3 —Ä–∏—Å–æ—á–∫–∏) */
        .menu-icon { position: fixed; top: 20px; right: 20px; font-size: 30px; cursor: pointer; z-index: 1000; color: var(--main); }
        .sidebar { position: fixed; top: 0; right: -320px; width: 300px; height: 100%; background: #0d0e14; transition: 0.4s cubic-bezier(0.4, 0, 0.2, 1); z-index: 999; padding: 60px 25px; border-left: 1px solid var(--main); }
        .sidebar.active { right: 0; }
        .menu-link { display: block; padding: 15px 0; color: #ccc; text-decoration: none; border-bottom: 1px solid #222; cursor: pointer; transition: 0.3s; }
        .menu-link:hover { color: var(--main); padding-left: 5px; }

        /* –ì–æ–ª–æ–≤–Ω–∞ –∫—Ä—É–≥–ª–∞ –∫–Ω–æ–ø–∫–∞ (Speedtest Style) */
        .hero { min-height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; }
        .main-circle-btn {
            width: 220px; height: 220px; border-radius: 50%; border: 4px solid var(--main);
            background: transparent; color: white; font-size: 20px; font-weight: bold;
            cursor: pointer; box-shadow: 0 0 30px rgba(0, 242, 255, 0.2);
            transition: 0.4s; display: flex; align-items: center; justify-content: center;
            text-transform: uppercase; letter-spacing: 2px; outline: none;
        }
        .main-circle-btn:hover:not(:disabled) { box-shadow: 0 0 60px var(--main); transform: scale(1.05); background: rgba(0, 242, 255, 0.05); }
        .main-circle-btn:disabled { border-color: #333; color: #444; box-shadow: none; cursor: not-allowed; }

        /* –§–æ—Ä–º–∏ —Ç–∞ –ú–æ–¥–∞–ª–∫–∏ */
        .glass { background: rgba(255,255,255,0.03); backdrop-filter: blur(15px); border: 1px solid rgba(255,255,255,0.08); border-radius: 25px; padding: 30px; width: 90%; max-width: 400px; margin-top: 20px; }
        input { width: 100%; padding: 14px; margin: 10px 0; background: #16171d; border: 1px solid #333; color: white; border-radius: 10px; box-sizing: border-box; font-size: 16px; }
        .status-msg { font-size: 13px; color: var(--main); margin-top: 15px; min-height: 20px; }
        
        .modal { display: none; position: fixed; z-index: 2000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); overflow-y: auto; }
        .modal-content { background: #0d0e14; margin: 5% auto; padding: 25px; width: 90%; max-width: 600px; border-radius: 20px; border: 1px solid var(--main); }
        .rev-item { border-bottom: 1px solid #222; padding: 15px 0; }
        .stars { color: #ffcc00; margin-bottom: 5px; }
    </style>
</head>
<body>

    <div class="profile-trigger" onclick="toggleProfile()">
        <img id="user-avatar" src="https://img.icons8.com/ios-glyphs/90/ffffff/user--v1.png">
    </div>

    <div class="profile-card" id="profileCard">
        <h4 id="user-name" style="margin:0 0 5px 0;">–ì—ñ—Å—Ç—å –ü–ª–∞—Ç—Ñ–æ—Ä–º–∏</h4>
        <p style="font-size:12px; color:var(--main); margin:0;">ID: <span id="display-id">TN-000000</span></p>
        <p style="font-size:13px; margin:10px 0;">–£—Å–ø—ñ—à–Ω–∏—Ö —É–≥–æ–¥: <b id="user-deals">0</b></p>
        
        <div id="admin-section" style="display:none; border-top:1px solid #333; margin-top:10px; padding-top:10px;">
            <p style="color:gold; font-size:11px; font-weight:bold;">üîî –ê–î–ú–Ü–ù-–ü–ê–ù–ï–õ–¨:</p>
            <div id="admin-logs" style="font-size:10px; color:#888; max-height:100px; overflow-y:auto;">–ù–µ–º–∞—î –Ω–æ–≤–∏—Ö —Å–ø–æ–≤—ñ—â–µ–Ω—å</div>
        </div>
    </div>

    <div class="menu-icon" onclick="toggleMenu()">‚ò∞</div>

    <div class="sidebar" id="sidebar">
        <div id="g_id_onload" 
             data-client_id="–í–°–¢–ê–í_–°–í–Ü–ô_GOOGLE_CLIENT_ID_–¢–£–¢" 
             data-callback="onSignIn">
        </div>
        <div class="g_id_signin" data-type="standard"></div>
        
        <nav style="margin-top:40px;">
            <a onclick="showReviews()" class="menu-link">üí¨ –í—ñ–¥–≥—É–∫–∏ (514)</a>
            <a class="menu-link">üåê –ú–æ–≤–∞: <span style="color:var(--main)">UA</span> | EN | RU</a>
            <a href="https://t.me/pingvin4ikpororo" target="_blank" class="menu-link" style="color:#0088cc;">‚úàÔ∏è –ì—Ä—É–ø–∞ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏</a>
            <a onclick="location.reload()" class="menu-link" style="color:#ff4444;">üîÑ –ó–º—ñ–Ω–∏—Ç–∏ –∞–∫–∫–∞—É–Ω—Ç</a>
        </nav>
    </div>

    <div class="hero">
        <div id="screen-main">
            <h1 style="letter-spacing:12px; color:var(--main); margin:0;">TRUST_NODE</h1>
            <p style="opacity:0.4; font-size:11px; margin-bottom:50px; letter-spacing:3px;">INTERNATIONAL ESCROW SYSTEM</p>
            <button class="main-circle-btn" id="start-btn" onclick="showStep('connect')" disabled>–ü–û–ß–ê–¢–ò</button>
            <p id="login-warn" style="font-size:12px; color:#555; margin-top:20px;">–ê–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å –≤ –º–µ–Ω—é –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –º–æ—Å—Ç—É</p>
        </div>

        <div class="glass" id="screen-connect" style="display:none">
            <h3>–°—Ç–≤–æ—Ä–µ–Ω–Ω—è –º–æ—Å—Ç—É</h3>
            <input type="text" id="target-id" placeholder="ID –ü–æ–∫—É–ø—Ü—è (TN-XXXXXX)">
            <input type="number" id="deal-price" placeholder="–°—É–º–∞ —É–≥–æ–¥–∏ (‚Ç¥)">
            <button class="main-circle-btn" style="width:120px; height:120px; font-size:12px; margin:20px auto;" onclick="initBridge()">–ê–ö–¢–ò–í–£–í–ê–¢–ò</button>
        </div>

        <div class="glass" id="screen-confirm" style="display:none">
            <h3 id="confirm-msg">–í–∏ –∫—É–ø—É—î—Ç–µ —Ç–æ–≤–∞—Ä?</h3>
            <p style="font-size:12px; opacity:0.6;">–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ ID –ø—Ä–æ–¥–∞–≤—Ü—è –ø–µ—Ä–µ–¥ –∑'—î–¥–Ω–∞–Ω–Ω—è–º</p>
            <button class="main-circle-btn" style="width:120px; height:120px; font-size:12px; margin:20px auto;" onclick="handleBridge(true)">–¢–ê–ö</button>
        </div>

        <div class="glass" id="screen-pay" style="display:none">
            <h2 id="display-sum" style="color:var(--main); margin:0;">0.00 ‚Ç¥</h2>
            <div id="pay-status" class="status-msg">–û—á—ñ–∫—É–≤–∞–Ω–Ω—è –ø–ª–∞—Ç–µ–∂—É...</div>
            <input type="text" placeholder="–ö–∞—Ä—Ç–∞ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó ****">
            <button class="main-circle-btn" style="width:120px; height:120px; font-size:12px; margin:20px auto;" onclick="syncMono()">–ü–ï–†–ï–í–Ü–†–ò–¢–ò</button>
        </div>

        <div class="glass" id="screen-finish" style="display:none">
            <h3 style="color:var(--main);">–ì–†–û–®–Ü –ó–ê–ú–û–†–û–ñ–ï–ù–û üõ°Ô∏è</h3>
            <p id="finish-text" style="font-size:14px; line-height:1.6;"></p>
            <div id="buyer-confirm-btn" style="display:none">
                <button class="main-circle-btn" style="width:140px; height:140px; font-size:12px; margin:20px auto;" onclick="closeDeal()">–ü–Ü–î–¢–í–ï–†–î–ò–¢–ò –û–¢–†–ò–ú–ê–ù–ù–Ø</button>
            </div>
        </div>
    </div>

    <div id="reviewsModal" class="modal">
        <div class="modal-content">
            <span style="float:right; cursor:pointer; font-size:24px;" onclick="closeReviews()">√ó</span>
            <h2 style="color:var(--main)">–†–µ–ø—É—Ç–∞—Ü—ñ—è TRUST_NODE</h2>
            <div id="modal-rev-list"></div>
        </div>
    </div>

    <script src="config.js"></script>
    <script>
        // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –¥–∞–Ω–∏—Ö —é–∑–µ—Ä–∞
        let user = { 
            email: "", 
            id: "TN-" + Math.floor(100000 + Math.random() * 800000),
            name: "–ì—ñ—Å—Ç—å"
        };
        let currentDealId = null;

        function toggleMenu() { document.getElementById('sidebar').classList.toggle('active'); }
        function toggleProfile() { 
            const p = document.getElementById('profileCard');
            p.style.display = p.style.display === 'block' ? 'none' : 'block';
        }

        // –í—Ö—ñ–¥ —á–µ—Ä–µ–∑ Google
        function onSignIn(resp) {
            const payload = JSON.parse(atob(resp.credential.split('.')[1]));
            user.email = payload.email;
            user.name = payload.name;
            
            document.getElementById('user-avatar').src = payload.picture;
            document.getElementById('user-name').innerText = user.name;
            document.getElementById('display-id').innerText = user.id;
            document.getElementById('user-deals').innerText = Math.floor(Math.random() * 14) + 4;
            
            document.getElementById('start-btn').disabled = false;
            document.getElementById('login-warn').style.display = 'none';
            
            if(user.email === CONFIG.adminEmail) {
                document.getElementById('admin-section').style.display = 'block';
            }
            toggleMenu();
            listenForDeals();
        }

        function showStep(s) {
            document.querySelectorAll('.glass, #screen-main').forEach(el => el.style.display = 'none');
            document.getElementById('screen-' + s).style.display = 'block';
        }

        // –ü—Ä–æ–¥–∞–≤–µ—Ü—å —Å—Ç–≤–æ—Ä—é—î –º—ñ—Å—Ç
        async function initBridge() {
            const tid = document.getElementById('target-id').value;
            const pr = parseFloat(document.getElementById('deal-price').value);
            if(!tid || !pr) return alert("–ó–∞–ø–æ–≤–Ω—ñ—Ç—å –¥–∞–Ω—ñ –º–æ—Å—Ç—É!");
            
            currentDealId = user.id + "_" + tid;
            await db.collection("deals").doc(currentDealId).set({
                seller: user.id, buyer: tid, amount: pr, status: "waiting", paid: 0, timestamp: Date.now()
            });
            alert("–ú—ñ—Å—Ç –∞–∫—Ç–∏–≤–æ–≤–∞–Ω–æ. –û—á—ñ–∫—É–π—Ç–µ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –ø–æ–∫—É–ø—Ü–µ–º.");
        }

        // –ü–æ–∫—É–ø–µ—Ü—å –ª–æ–≤–∏—Ç—å –∑–∞–ø–∏—Ç
        function listenForDeals() {
            db.collection("deals").where("buyer", "==", user.id).onSnapshot(snap => {
                snap.forEach(doc => {
                    const d = doc.data();
                    currentDealId = doc.id;
                    if(d.status === "waiting") {
                        document.getElementById('confirm-msg').innerText = `–ö—É–ø—ñ–≤–ª—è —É ${d.seller} –Ω–∞ —Å—É–º—É ${d.amount} ‚Ç¥?`;
                        showStep('confirm');
                    }
                    updateGlobalUI(d);
                });
            });
            // –ü—Ä–æ–¥–∞–≤–µ—Ü—å –ª–æ–≤–∏—Ç—å –æ–Ω–æ–≤–ª–µ–Ω–Ω—è
            db.collection("deals").where("seller", "==", user.id).onSnapshot(snap => {
                snap.forEach(doc => updateGlobalUI(doc.data()));
            });
        }

        async function handleBridge(agree) {
            if(agree) {
                await db.collection("deals").doc(currentDealId).update({status: "active"});
                showStep('pay');
            }
        }

        // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ Monobank API
        async function syncMono() {
            const statusEl = document.getElementById('pay-status');
            statusEl.innerText = "–ó'—î–¥–Ω–∞–Ω–Ω—è –∑ –±–∞–Ω–∫—ñ–≤—Å—å–∫–∏–º –≤—É–∑–ª–æ–º...";
            
            try {
                const res = await fetch(`https://api.monobank.ua/personal/statement/0/${Math.floor(Date.now()/1000)-600}`, {
                    headers: {'X-Token': CONFIG.monoToken}
                });
                const txs = await res.json();
                const dealDoc = await db.collection("deals").doc(currentDealId).get();
                const deal = dealDoc.data();

                let total = txs.filter(t => t.amount > 0).reduce((s, t) => s + (t.amount/100), 0);
                let need = deal.amount - total;

                if(need <= 0) {
                    await db.collection("deals").doc(currentDealId).update({status: "paid", paid: total});
                } else {
                    statusEl.innerText = `–û—Ç—Ä–∏–º–∞–Ω–æ: ${total} ‚Ç¥. –ó–∞–ª–∏—à–∏–ª–æ—Å—å: ${need.toFixed(2)} ‚Ç¥`;
                }
            } catch(e) { statusEl.innerText = "–ü–æ–º–∏–ª–∫–∞ –∑–≤'—è–∑–∫—É –∑ API."; }
        }

        function updateGlobalUI(d) {
            if(d.status === "active" && user.id === d.buyer) {
                document.getElementById('display-sum').innerText = d.amount + " ‚Ç¥";
                showStep('pay');
            }
            if(d.status === "paid") {
                showStep('finish');
                if(user.id === d.seller) {
                    document.getElementById('finish-text').innerText = "–ü–æ–∫—É–ø–µ—Ü—å –≤–Ω—ñ—Å –∫–æ—à—Ç–∏. –ü–µ—Ä–µ–¥–∞–π—Ç–µ —Ç–æ–≤–∞—Ä (–∞–∫–∞—É–Ω—Ç/–¥–∞–Ω—ñ) –ø–æ–∫—É–ø—Ü—é –≤ –æ—Å–æ–±–∏—Å—Ç—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è.";
                } else {
                    document.getElementById('finish-text').innerText = "–ì—Ä–æ—à—ñ –≤ –ì–∞—Ä–∞–Ω—Ç–∞. –û—á—ñ–∫—É–π—Ç–µ –¥–∞–Ω—ñ –≤—ñ–¥ –ø—Ä–æ–¥–∞–≤—Ü—è. –ü—ñ—Å–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å –∫–Ω–æ–ø–∫—É –Ω–∏–∂—á–µ.";
                    document.getElementById('buyer-confirm-btn').style.display = 'block';
                }
                if(user.email === CONFIG.adminEmail) {
                    const prof = d.amount * CONFIG.fee;
                    document.getElementById('admin-logs').innerHTML = `üí∏ –ó–ê–†–ê–•–û–í–ê–ù–û: ${d.amount} ‚Ç¥<br>–¢–≤—ñ–π –ø—Ä–æ—Ñ—ñ—Ç: ${prof.toFixed(2)} ‚Ç¥<br>–í–∏–ø–ª–∞—Ç–∏—Ç–∏ –ø—Ä–æ–¥–∞–≤—Ü—é: ${(d.amount-prof).toFixed(2)} ‚Ç¥`;
                }
            }
        }

        async function closeDeal() {
            await db.collection("deals").doc(currentDealId).update({status: "completed"});
            alert("–£–≥–æ–¥–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞! –ú–æ–¥–µ—Ä–∞—Ç–æ—Ä –≤–∏–ø–ª–∞—Ç–∏—Ç—å –∫–æ—à—Ç–∏ –ø—Ä–æ–¥–∞–≤—Ü—é –ø—Ä–æ—Ç—è–≥–æ–º 15 —Ö–≤.");
            location.reload();
        }

        // –õ–æ–≥—ñ–∫–∞ –≤—ñ–¥–≥—É–∫—ñ–≤
        const reviews = [
            {s:5, t:"Best service for game accounts. High fee but safe.", l:"en"},
            {s:3, t:"–ö–æ–º—ñ—Å—ñ—è 11% ‚Äî —Ü–µ –±–∞–≥–∞—Ç–æ, –∞–ª–µ –≤—Å–µ —á–µ—Å–Ω–æ, –≥—Ä–æ—à—ñ –ø—Ä–∏–π—à–ª–∏.", l:"ua"},
            {s:4, t:"–ñ–¥–∞–ª –≤—ã–ø–ª–∞—Ç—É –ø–æ–ª—á–∞—Å–∞, –Ω–æ –∞–¥–º–∏–Ω –≤ —Ç–≥ –æ—Ç–≤–µ—Ç–∏–ª –±—ã—Å—Ç—Ä–æ.", l:"ru"},
            {s:5, t:"Trusted node! Done deal for 5000 UAH.", l:"en"},
            {s:2, t:"–°–ª–∏—à–∫–æ–º —Å–ª–æ–∂–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ –≥—É–≥–ª.", l:"ru"}
        ];

        function showReviews() {
            document.getElementById('reviewsModal').style.display = "block";
            let h = "";
            for(let i=0; i<50; i++) {
                const r = reviews[i % reviews.length];
                h += `<div class="rev-item"><div class="stars">${"‚òÖ".repeat(r.s)}${"‚òÜ".repeat(5-r.s)}</div><p style="font-size:14px;">${r.t}</p></div>`;
            }
            document.getElementById('modal-rev-list').innerHTML = h;
            toggleMenu();
        }
        function closeReviews() { document.getElementById('reviewsModal').style.display = "none"; }
    </script>
</body>
</html>

